<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆå°±ç³»ç»Ÿ - C++å­¦ä¹ ç½‘ç«™</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style2.css">
    <link rel="stylesheet" href="../css/achievements.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">C++å­¦ä¹ å…¥é—¨</div>
            <ul class="nav-links">
                <li><a href="../index.html">é¦–é¡µ</a></li>
                <li><a href="basics.html">åŸºç¡€è¯­æ³•</a></li>
                <li><a href="oop.html">é¢å‘å¯¹è±¡</a></li>
                <li><a href="advanced.html">é«˜çº§ç‰¹æ€§</a></li>
                <li><a href="effective.html">Effective C++</a></li>
                <li><a href="stl.html">STLæºç å‰–æ</a></li>
                <li><a href="quiz.html">é¢˜åº“</a></li>
                <li><a href="achievements.html" class="active">æˆå°±ç³»ç»Ÿ</a></li>
                <li><a href="../forum.html">è®ºå›</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle">è´¦æˆ· <i class="fas fa-chevron-down"></i></a>
                    <ul class="dropdown-menu">
                        <li><a href="#login-modal">ç™»å½•</a></li>
                        <li><a href="#register-modal">æ³¨å†Œ</a></li>
                    </ul>
                </li>
                <li><a href="../about.html">å…³äºæˆ‘ä»¬</a></li>
                <li><button id="theme-toggle" class="theme-toggle-btn"><i class="fas fa-moon"></i></button></li>
            </ul>
            <div class="burger">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
            </div>
        </nav>
    </header>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-trophy"></i>
                æˆå°±ç³»ç»Ÿ
            </h1>
            <p class="page-description">é€šè¿‡å®ŒæˆC++å­¦ä¹ æŒ‘æˆ˜æ¥è§£é”å„ç§æˆå°±ï¼Œå±•ç¤ºä½ çš„å­¦ä¹ æˆæœï¼</p>
        </div>

        <!-- ç™»å½•æç¤º -->
        <div id="login-required-notice" class="login-notice" style="display: none;">
            <div class="notice-content">
                <i class="fas fa-info-circle"></i>
                <div class="notice-text">
                    <h3>éœ€è¦ç™»å½•è´¦æˆ·</h3>
                    <p>ä¸ºäº†è·å¾—æˆå°±å¹¶ä¿å­˜æ‚¨çš„å­¦ä¹ è¿›åº¦ï¼Œè¯·å…ˆç™»å½•æ‚¨çš„è´¦æˆ·ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰è´¦æˆ·ï¼Œå¯ä»¥å…è´¹æ³¨å†Œä¸€ä¸ªã€‚</p>
                </div>
            </div>
        </div>

        <!-- æˆå°±ç»Ÿè®¡ -->
        <div id="achievement-stats" class="achievement-stats" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="unlocked-count">0</h3>
                        <p>å·²è§£é”æˆå°±</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="locked-count">5</h3>
                        <p>å¾…è§£é”æˆå°±</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="progress-percentage">0%</h3>
                        <p>å®Œæˆè¿›åº¦</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="latest-achievement">æš‚æ— </h3>
                        <p>æœ€æ–°æˆå°±</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- æˆå°±åˆ—è¡¨ -->
        <div id="achievements-container" class="achievements-container" style="display: none;">
            <h2 class="section-title">
                <i class="fas fa-award"></i>
                æˆ‘çš„æˆå°±
            </h2>
            <div id="achievements-grid" class="achievements-grid">
                <!-- æˆå°±å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æˆå°±æŒ‡å— -->
        <div class="achievement-guide">
            <h2 class="section-title">
                <i class="fas fa-map"></i>
                æˆå°±è·å–æŒ‡å—
            </h2>
            <div class="guide-grid">
                <div class="guide-card">
                    <div class="guide-icon">ğŸŒ±</div>
                    <h3>åˆå‡ºèŒ…åº</h3>
                    <p>å®ŒæˆåŸºç¡€è¯­æ³•éƒ¨åˆ†çš„8é“é¢˜ç›®å¹¶å…¨éƒ¨ç­”å¯¹ã€‚è¿™æ˜¯æ‚¨C++å­¦ä¹ æ—…ç¨‹çš„ç¬¬ä¸€æ­¥ï¼</p>
                    <div class="guide-requirement">
                        <i class="fas fa-check-circle"></i>
                        åŸºç¡€è¯­æ³•ï¼š8/8 æ­£ç¡®
                    </div>
                </div>
                <div class="guide-card">
                    <div class="guide-icon">ğŸ”§</div>
                    <h3>ç‰›åˆ€å°è¯•</h3>
                    <p>æŒæ¡é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®Œæˆæ‰€æœ‰ç›¸å…³é¢˜ç›®å¹¶å–å¾—æ»¡åˆ†ã€‚</p>
                    <div class="guide-requirement">
                        <i class="fas fa-check-circle"></i>
                        é¢å‘å¯¹è±¡ï¼š8/8 æ­£ç¡®
                    </div>
                </div>
                <div class="guide-card">
                    <div class="guide-icon">ğŸ›ï¸</div>
                    <h3>ç™»å ‚å…¥å®¤</h3>
                    <p>æ·±å…¥ç†è§£C++çš„é«˜çº§ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ¨¡æ¿ã€å¼‚å¸¸å¤„ç†ç­‰å¤æ‚æ¦‚å¿µã€‚</p>
                    <div class="guide-requirement">
                        <i class="fas fa-check-circle"></i>
                        é«˜çº§ç‰¹æ€§ï¼š8/8 æ­£ç¡®
                    </div>
                </div>
                <div class="guide-card">
                    <div class="guide-icon">ğŸ’</div>
                    <h3>ç²¾ç›Šæ±‚ç²¾</h3>
                    <p>æŒæ¡Effective C++çš„æœ€ä½³å®è·µï¼Œæˆä¸ºçœŸæ­£çš„C++ç¼–ç¨‹ä¸“å®¶ã€‚</p>
                    <div class="guide-requirement">
                        <i class="fas fa-check-circle"></i>
                        Effective C++ï¼š8/8 æ­£ç¡®
                    </div>
                </div>
                <div class="guide-card">
                    <div class="guide-icon">ğŸ‘‘</div>
                    <h3>ç™»å³°é€ æ</h3>
                    <p>æ·±å…¥STLæºç è§£æï¼Œè¾¾åˆ°C++ç¼–ç¨‹çš„æœ€é«˜å¢ƒç•Œã€‚</p>
                    <div class="guide-requirement">
                        <i class="fas fa-check-circle"></i>
                        STLæºç è§£æï¼š8/8 æ­£ç¡®
                    </div>
                </div>
            </div>
        </div>

        <!-- å­¦ä¹ å»ºè®® -->
        <div class="learning-tips">
            <h2 class="section-title">
                <i class="fas fa-lightbulb"></i>
                å­¦ä¹ å»ºè®®
            </h2>
            <div class="tips-content">
                <div class="tip-item">
                    <i class="fas fa-graduation-cap"></i>
                    <div>
                        <h4>å¾ªåºæ¸è¿›</h4>
                        <p>å»ºè®®æŒ‰ç…§åŸºç¡€è¯­æ³• â†’ é¢å‘å¯¹è±¡ â†’ é«˜çº§ç‰¹æ€§ â†’ Effective C++ â†’ STLæºç è§£æçš„é¡ºåºå­¦ä¹ ã€‚</p>
                    </div>
                </div>
                <div class="tip-item">
                    <i class="fas fa-code"></i>
                    <div>
                        <h4>å®è·µä¸ºä¸»</h4>
                        <p>ç†è®ºå­¦ä¹ åï¼Œé€šè¿‡é¢˜åº“ç»ƒä¹ å·©å›ºçŸ¥è¯†ç‚¹ï¼Œå‘ç°å¹¶å¡«è¡¥çŸ¥è¯†ç›²åŒºã€‚</p>
                    </div>
                </div>
                <div class="tip-item">
                    <i class="fas fa-users"></i>
                    <div>
                        <h4>äº¤æµè®¨è®º</h4>
                        <p>åœ¨è®¨è®ºåŒºä¸å…¶ä»–å­¦ä¹ è€…äº¤æµå¿ƒå¾—ï¼Œå…±åŒè¿›æ­¥ã€‚</p>
                    </div>
                </div>
                <div class="tip-item">
                    <i class="fas fa-clock"></i>
                    <div>
                        <h4>æŒç»­å­¦ä¹ </h4>
                        <p>C++æ˜¯ä¸€é—¨å¤æ‚çš„è¯­è¨€ï¼Œéœ€è¦æŒç»­ä¸æ–­åœ°å­¦ä¹ å’Œç»ƒä¹ ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>

    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="../js/data-storage.js"></script>
    <script src="../js/achievements.js"></script>
    <script src="../js/main2.js"></script>
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initAchievementsPage();
        });

        // åˆå§‹åŒ–æˆå°±é¡µé¢
        function initAchievementsPage() {
            // åˆ·æ–°æˆå°±ç³»ç»Ÿçš„ç”¨æˆ·æ•°æ®
            if (window.AchievementSystem && typeof window.AchievementSystem.refreshUserData === 'function') {
                window.AchievementSystem.refreshUserData();
            }
            
            const currentUser = window.AchievementSystem.getCurrentUser();
            
            if (!currentUser) {
                // ç”¨æˆ·æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•æç¤º
                document.getElementById('login-required-notice').style.display = 'block';
                document.getElementById('achievement-stats').style.display = 'none';
                document.getElementById('achievements-container').style.display = 'none';
                console.log('ç”¨æˆ·æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•æç¤º');
            } else {
                // ç”¨æˆ·å·²ç™»å½•ï¼Œæ˜¾ç¤ºæˆå°±å†…å®¹
                document.getElementById('login-required-notice').style.display = 'none';
                document.getElementById('achievement-stats').style.display = 'block';
                document.getElementById('achievements-container').style.display = 'block';
                console.log(`ç”¨æˆ· ${currentUser.username} å·²ç™»å½•ï¼Œæ˜¾ç¤ºæˆå°±å†…å®¹`);
                
                // åŠ è½½å¹¶æ˜¾ç¤ºæˆå°±æ•°æ®
                loadAchievements();
            }
        }

        // åŠ è½½æˆå°±æ•°æ®
        function loadAchievements() {
            const achievementSystem = window.AchievementSystem;
            const stats = achievementSystem.getAchievementStats();
            const achievements = achievementSystem.getAllAchievements();
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            document.getElementById('unlocked-count').textContent = stats.unlocked;
            document.getElementById('locked-count').textContent = stats.locked;
            document.getElementById('progress-percentage').textContent = stats.progress + '%';
            
            // è·å–æœ€æ–°è§£é”çš„æˆå°±
            const unlockedAchievements = achievementSystem.getUnlockedAchievements();
            if (unlockedAchievements.length > 0) {
                const latest = unlockedAchievements.sort((a, b) => 
                    new Date(b.unlockedAt) - new Date(a.unlockedAt)
                )[0];
                document.getElementById('latest-achievement').textContent = latest.name;
            }
            
            // æ¸²æŸ“æˆå°±å¡ç‰‡
            renderAchievements(achievements);
        }

        // æ¸²æŸ“æˆå°±å¡ç‰‡
        function renderAchievements(achievements) {
            const grid = document.getElementById('achievements-grid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const achievementCard = document.createElement('div');
                achievementCard.className = `achievement-card ${achievement.unlocked ? 'unlocked' : 'locked'}`;
                
                const unlockedDate = achievement.unlockedAt ? 
                    new Date(achievement.unlockedAt).toLocaleDateString('zh-CN') : '';
                
                achievementCard.innerHTML = `
                    <div class="achievement-icon">
                        ${achievement.unlocked ? achievement.icon : 'ğŸ”’'}
                    </div>
                    <div class="achievement-content">
                        <h3 class="achievement-name">${achievement.name}</h3>
                        <p class="achievement-description">${achievement.description}</p>
                        <div class="achievement-requirement">
                            ${getRequirementText(achievement.requirement)}
                        </div>
                        ${achievement.unlocked ? 
                            `<div class="achievement-date">
                                <i class="fas fa-calendar"></i>
                                ${unlockedDate}
                            </div>` : 
                            '<div class="achievement-locked">æœªè§£é”</div>'
                        }
                    </div>
                    ${achievement.unlocked ? '<div class="achievement-badge"><i class="fas fa-check"></i></div>' : ''}
                `;
                
                grid.appendChild(achievementCard);
            });
        }

        // è·å–è¦æ±‚æ–‡æœ¬
        function getRequirementText(requirement) {
            const sectionNames = {
                'basic': 'åŸºç¡€è¯­æ³•',
                'oop': 'é¢å‘å¯¹è±¡',
                'advanced': 'é«˜çº§ç‰¹æ€§',
                'effective': 'Effective C++',
                'stl': 'STLæºç è§£æ'
            };
            
            return `${sectionNames[requirement.section]}ï¼š${requirement.score}/${requirement.total} æ­£ç¡®`;
        }

        // æ‰“å¼€ç™»å½•æ¨¡æ€æ¡†
        function openLoginModal() {
            const loginModal = document.getElementById('login-modal');
            if (loginModal) {
                closeAllModals();
                loginModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            } else {
                // å¦‚æœæ¨¡æ€æ¡†ä¸å­˜åœ¨ï¼Œå‘é€è‡ªå®šä¹‰äº‹ä»¶
                const event = new CustomEvent('openModal', { detail: 'login' });
                document.dispatchEvent(event);
            }
        }

        // æ‰“å¼€æ³¨å†Œæ¨¡æ€æ¡†
        function openRegisterModal() {
            const registerModal = document.getElementById('register-modal');
            if (registerModal) {
                closeAllModals();
                registerModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            } else {
                // å¦‚æœæ¨¡æ€æ¡†ä¸å­˜åœ¨ï¼Œå‘é€è‡ªå®šä¹‰äº‹ä»¶
                const event = new CustomEvent('openModal', { detail: 'register' });
                document.dispatchEvent(event);
            }
        }

        // å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†
        function closeAllModals() {
            const modals = ['login-modal', 'register-modal', 'forgot-password-modal', 'terms-modal', 'privacy-modal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                }
            });
            // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = '';
        }

        // ç›‘å¬ç”¨æˆ·ç™»å½•çŠ¶æ€å˜åŒ–
        document.addEventListener('userLoginStateChanged', function() {
            initAchievementsPage();
        });

        // æ·»åŠ localStorageç›‘å¬å™¨ä»¥æ£€æµ‹è·¨æ ‡ç­¾é¡µçš„ç™»å½•çŠ¶æ€å˜åŒ–
        let lastLoginState = localStorage.getItem('currentUser');
        
        // ç›‘å¬localStorageå˜åŒ–ï¼ˆè·¨æ ‡ç­¾é¡µï¼‰
        window.addEventListener('storage', function(e) {
            if (e.key === 'currentUser') {
                const currentLoginState = e.newValue;
                if (currentLoginState !== lastLoginState) {
                    lastLoginState = currentLoginState;
                    console.log('æ£€æµ‹åˆ°localStorageä¸­çš„ç™»å½•çŠ¶æ€å˜åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–é¡µé¢');
                    initAchievementsPage();
                }
            }
        });

        // å®šæœŸæ£€æŸ¥ç™»å½•çŠ¶æ€å˜åŒ–ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼Œå¤„ç†åŒæ ‡ç­¾é¡µå†…çš„å˜åŒ–ï¼‰
        let lastUser = window.AchievementSystem.getCurrentUser();
        setInterval(function() {
            const currentUser = window.AchievementSystem.getCurrentUser();
            const currentUserStr = currentUser ? JSON.stringify(currentUser) : null;
            const lastUserStr = lastUser ? JSON.stringify(lastUser) : null;
            
            if (currentUserStr !== lastUserStr) {
                console.log('æ£€æµ‹åˆ°ç”¨æˆ·ç™»å½•çŠ¶æ€å˜åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–é¡µé¢');
                lastUser = currentUser;
                initAchievementsPage();
            }
        }, 2000); // æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
    </script>

    <footer>
        <p>&copy; 2025 C++å­¦ä¹ å…¥é—¨ç½‘ç«™. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
    </footer>
</body>
</html>
